### 执行上下文和执行栈

#### 什么是执行上下文？

用来执行 Javascript 代码的运行环境，其中包含当前执行环境中的**变量、函数声明、作用域链、this** 等信息。

#### 执行上下文的核心概念

1. **执行栈**

    概念：是一种`先进后出`数据结构，用来存储代码运行的所有执行上下文

    **执行过程：**

    - 当 JS 引擎第一次遇到 js 脚本时，会创建一个全局执行上下文并且压入当前执行栈
    - 每当 JS 引擎遇到一个函数调用，它会为该函数创建一个新的执行上下文并压入栈顶
    - 当该函数执行结束时，执行上下文从栈中弹出，控制流程到达栈中的下一个上下文
    - 当所有代码执行完毕，JS 引擎从当前栈中移除全局执行上下文

2. **生命周期**

    1）创建阶段 - 生成变量对象、建立作用域链、确定 this 的指向

    _变量对象_

    _是与执行上下文相关的数据作用域，存储了上下文中定义的变量和函数声明\_ \_全局指向上下文中，变量对象就是全局对象。在顶层 js 代码中，this 指向全局对象，全局变量会作为该对象的属性来被查询。在浏览器中，window 就是全局对象_

    2）执行阶段 - 变量赋值、函数的引用、执行其他代码

    3）销毁阶段 - 执行完毕后出栈，等待垃圾回收

3. **执行上下文的种类**

    1）全局执行上下文（浏览器环境下，为全局的 `window` 对象）

    2）函数执行上下文，每当一个函数被调用时，都会为该函数创建一个新的上下文

    3）Eval 函数执行上下文

4. **执行上下文的特点**

    1）单线程，只在主线程上运行；

    2）同步执行，自上而下；

    3）全局上下文唯一，即 `window` 对象；

    4）函数每次调用就会产生一个新的执行上下文环境

---

### 作用域

1.  **概念**
    -   作用域就是可访问`变量（对象和函数）`的集合，最大的用处是用来隔离变量，不同作用域下同名变量不会冲突
2.  **作用域类型**

    分为两种：全局作用域和局部作用域，其中局部作用域分为`函数作用域`和 `ES6新增的块级作用域`

    -   **全局作用域**

        全局作用域贯穿整个 javascript 文档，在所有函数声明或大括号之外定义的变量，都在全局作用域上。一旦声明了全局变量，你在任何地方都可以使用它；

        `Javascript` 默认拥有一个全局对象 `window`,声明一个全局变量，就是为window对象的同名属性赋值；

        若变量在函数内部没有声明（未使用 `var` 关键字），该变量为全局变量，全局变量在页面关闭后销毁。

    -   **局部作用域**

        通常情况下，局部作用域中的变量，在局部作用域外无法访问到，闭包除外；

        当函数体内局部变量和体外变量同名时，优先使用局部变量。

        -   **函数作用域**

            指声明在函数内部的变量的集合，函数的作用域在定义时就决定了

        -   **块级作用域**

            块级作用域由`{}`包括，`if`和`for`语句里的`{}`也属于块级作用域；

            在块级作用域中，可以用 `let`和`const`声明变量，该变量在指定的块级作用域之外无法访问，如果是用 `var`在其中声明变量，则会被提升到上一级函数作用域或全局作用域中。

3.  **作用域链**

    当查找变量的时候，首先会从当前作用域（当前上下文的变量对象）中找，如果没有找到就会去父级上下文的变量对象中找，如果还没有找到，一直找到全局上下文的变量对象即全局对象，这样由多个上下文的变量对象（多级作用域）构成的查询链路就叫`作用域链`

---

${toc}
